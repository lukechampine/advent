package main

import (
	"bytes"

	"github.com/lukechampine/advent/utils"
)

const input = `x=526, y=383..390
y=1644, x=567..577
x=537, y=1595..1603
x=688, y=299..320
y=1434, x=607..626
y=1114, x=539..555
x=672, y=1727..1737
y=1359, x=637..639
y=306, x=501..521
x=665, y=1766..1778
x=689, y=800..803
x=619, y=395..411
x=598, y=395..411
x=578, y=815..825
y=1373, x=629..645
y=812, x=661..683
x=524, y=1089..1105
y=1603, x=529..537
x=522, y=563..566
x=652, y=99..120
y=801, x=659..668
x=524, y=563..566
x=646, y=581..605
x=517, y=1928..1946
x=555, y=192..203
x=623, y=1630..1637
x=501, y=1191..1207
x=508, y=1817..1827
y=133, x=497..504
x=557, y=1306..1334
y=851, x=524..549
y=1086, x=494..509
y=1481, x=635..644
x=663, y=1041..1044
x=629, y=174..176
x=659, y=799..801
y=330, x=567..570
x=551, y=33..51
y=1075, x=517..525
x=534, y=657..683
x=627, y=101..116
x=683, y=972..991
y=1335, x=682..685
x=534, y=968..975
x=644, y=264..267
x=583, y=1099..1111
x=605, y=679..697
y=905, x=597..599
y=612, x=599..606
x=643, y=712..730
y=902, x=669..676
y=930, x=506..522
x=596, y=714..723
x=675, y=612..615
x=649, y=1419..1432
x=635, y=144..150
x=666, y=1745..1755
y=569, x=569..589
x=662, y=949..953
x=619, y=516..528
x=689, y=1726..1737
y=1891, x=659..684
y=605, x=633..646
y=1572, x=659..678
y=267, x=644..657
y=1277, x=646..649
x=541, y=1804..1814
x=600, y=1164..1168
x=502, y=1605..1608
x=667, y=73..85
x=623, y=1030..1037
x=665, y=1688..1692
x=682, y=1724..1734
x=653, y=1309..1318
y=1259, x=594..654
x=585, y=348..361
x=542, y=50..61
x=617, y=1121..1133
x=615, y=1579..1605
y=1741, x=511..538
x=527, y=670..677
y=201, x=576..591
y=481, x=513..530
x=692, y=1413..1427
x=516, y=157..162
x=541, y=793..805
x=559, y=894..899
x=632, y=1656..1665
x=555, y=452..465
y=652, x=582..598
y=1668, x=616..639
y=1308, x=493..509
y=1706, x=634..652
x=512, y=1968..1972
x=667, y=1427..1454
x=586, y=1681..1684
x=604, y=1206..1216
x=614, y=855..858
x=580, y=540..552
y=911, x=507..512
y=70, x=609..627
x=680, y=1669..1671
y=852, x=565..589
x=626, y=397..402
x=695, y=1171..1184
x=652, y=1541..1559
x=591, y=818..822
x=693, y=81..93
x=646, y=57..81
y=1380, x=503..505
x=607, y=777..794
x=500, y=1470..1481
y=1202, x=514..517
x=517, y=1054..1075
y=717, x=538..544
x=588, y=240..247
x=576, y=875..884
x=508, y=1867..1869
x=538, y=717..724
x=553, y=261..272
y=1650, x=675..677
x=566, y=194..206
x=638, y=1083..1099
x=636, y=297..318
x=592, y=182..190
x=521, y=281..306
x=647, y=1724..1745
x=678, y=934..957
x=588, y=1712..1718
x=635, y=1970..1984
x=581, y=392..403
x=588, y=1348..1364
x=525, y=870..875
x=669, y=1536..1545
y=1193, x=619..621
y=975, x=534..554
x=648, y=1143..1153
x=694, y=1258..1276
y=1447, x=508..534
y=272, x=553..570
x=618, y=1679..1697
x=622, y=766..775
x=614, y=479..498
x=679, y=800..803
y=803, x=679..689
y=320, x=684..688
y=1334, x=557..583
x=542, y=1027..1033
x=551, y=1548..1573
y=1875, x=494..518
x=658, y=1309..1318
x=687, y=821..823
y=1574, x=571..576
x=634, y=1184..1197
x=609, y=832..841
y=859, x=648..676
x=628, y=879..892
x=505, y=481..485
x=633, y=783..788
x=590, y=240..247
x=684, y=298..320
x=652, y=415..423
x=676, y=856..859
y=116, x=627..631
x=513, y=688..715
x=639, y=629..643
y=410, x=640..660
y=1361, x=604..607
x=638, y=1332..1345
x=635, y=943..945
x=581, y=1960..1969
x=591, y=918..930
x=592, y=1516..1521
x=601, y=1574..1601
y=241, x=623..638
x=612, y=996..1004
y=1616, x=492..515
y=845, x=601..618
x=667, y=1536..1545
y=631, x=527..533
y=1345, x=638..655
x=589, y=559..569
x=664, y=1017..1035
y=517, x=500..524
y=590, x=508..526
x=676, y=368..378
y=1210, x=553..578
x=591, y=640..649
x=647, y=1312..1321
y=627, x=611..633
y=175, x=675..680
x=624, y=181..206
x=635, y=836..861
x=502, y=31..42
x=660, y=497..505
y=1276, x=687..694
x=506, y=827..835
y=1301, x=649..671
x=606, y=602..612
x=568, y=661..670
x=532, y=1175..1179
y=1694, x=564..592
x=515, y=1395..1403
x=606, y=1635..1661
x=608, y=1465..1469
x=518, y=578..587
x=628, y=1353..1363
x=590, y=16..27
y=899, x=559..583
y=1360, x=660..666
y=295, x=644..669
x=654, y=1247..1259
y=1792, x=619..644
x=571, y=440..442
y=684, x=564..566
x=651, y=1588..1616
y=800, x=524..532
x=542, y=1466..1467
x=609, y=515..528
x=539, y=1963..1978
x=633, y=582..605
x=639, y=1267..1281
y=1281, x=639..656
x=652, y=1642..1650
x=501, y=1903..1906
y=1192, x=644..655
x=662, y=1068..1071
x=637, y=1725..1745
x=598, y=504..530
x=533, y=880..884
x=685, y=831..844
y=1215, x=640..642
x=513, y=9..21
y=252, x=682..695
x=505, y=1496..1505
x=551, y=370..384
x=625, y=856..858
x=622, y=354..381
x=568, y=371..384
x=514, y=1193..1202
x=615, y=1211..1213
y=1008, x=601..621
x=668, y=1603..1617
y=884, x=533..541
x=528, y=1969..1972
y=1888, x=672..675
y=27, x=564..590
x=543, y=1130..1137
x=640, y=1164..1175
y=247, x=499..511
x=675, y=796..806
x=570, y=1078..1088
x=569, y=559..569
y=50, x=575..589
x=660, y=1627..1637
x=608, y=898..908
x=681, y=1412..1427
x=651, y=742..766
y=1853, x=573..600
x=575, y=183..190
x=635, y=1122..1133
x=633, y=1162..1172
x=652, y=126..146
x=623, y=223..241
x=524, y=800..802
y=1605, x=502..506
y=639, x=650..655
x=529, y=1278..1280
x=530, y=105..115
x=635, y=1540..1559
x=623, y=1939..1964
x=660, y=1644..1654
x=601, y=980..990
x=601, y=816..825
x=593, y=1794..1816
x=510, y=69..78
x=525, y=1395..1403
y=1283, x=579..582
y=1828, x=567..582
x=538, y=218..226
x=643, y=1903..1916
y=1697, x=599..618
x=674, y=667..692
x=588, y=1017..1027
x=604, y=1359..1361
x=600, y=1879..1895
x=672, y=1024..1029
y=828, x=646..664
x=509, y=658..683
x=528, y=642..644
x=592, y=962..974
x=515, y=523..525
x=635, y=1947..1961
x=650, y=1208..1220
x=595, y=1631..1646
x=587, y=367..375
x=677, y=1806..1817
y=924, x=578..585
x=506, y=917..930
y=615, x=675..677
x=538, y=1273..1283
x=619, y=1786..1792
y=1418, x=495..521
y=1179, x=527..532
x=541, y=498..511
y=728, x=532..551
x=644, y=1471..1481
y=1389, x=653..672
x=676, y=1125..1131
x=609, y=66..70
y=1946, x=504..517
y=1070, x=590..614
x=644, y=1645..1654
y=977, x=614..624
y=1467, x=542..562
y=538, x=625..639
y=715, x=513..524
x=619, y=1188..1193
x=573, y=701..703
x=493, y=937..948
x=674, y=1705..1719
x=637, y=90..97
x=692, y=394..408
y=1004, x=612..614
y=387, x=577..596
x=600, y=1632..1646
y=1179, x=551..566
x=519, y=1135..1149
y=1505, x=595..597
y=1635, x=513..515
y=1984, x=615..635
x=561, y=45..68
x=514, y=403..404
x=524, y=724..737
y=788, x=633..636
x=583, y=1307..1334
x=599, y=1679..1697
x=599, y=941..952
x=693, y=1495..1520
y=390, x=522..526
x=549, y=519..532
x=621, y=668..692
x=636, y=1857..1876
y=93, x=693..695
y=119, x=521..539
x=509, y=1065..1086
x=565, y=1711..1718
y=68, x=561..567
y=294, x=538..586
x=555, y=1022..1036
x=632, y=90..97
y=322, x=655..664
x=613, y=1184..1197
x=605, y=1499..1509
y=1390, x=601..604
y=1884, x=672..675
x=677, y=833..848
x=552, y=130..142
x=594, y=1246..1259
x=668, y=799..801
x=614, y=996..1004
y=1972, x=544..552
x=526, y=31..42
x=627, y=1480..1492
x=627, y=66..70
x=657, y=602..622
y=1131, x=676..680
x=537, y=406..416
y=1131, x=565..582
x=554, y=496..506
x=675, y=627..640
x=575, y=36..50
x=614, y=966..977
y=75, x=515..518
y=1029, x=670..672
x=574, y=1835..1848
x=565, y=1408..1432
x=596, y=425..441
y=1869, x=508..510
x=518, y=218..226
y=1077, x=541..547
x=506, y=862..889
y=1301, x=512..537
x=557, y=32..51
y=1184, x=674..695
x=589, y=835..852
x=641, y=57..81
x=566, y=1252..1257
x=684, y=1877..1891
x=670, y=1024..1029
x=620, y=1484..1488
x=539, y=1521..1532
y=1964, x=623..628
y=353, x=588..595
y=136, x=603..611
x=675, y=1648..1650
x=584, y=799..810
x=565, y=412..422
x=633, y=803..814
y=142, x=527..552
x=495, y=1643..1655
x=621, y=1188..1193
x=518, y=1699..1709
x=577, y=1651..1663
x=541, y=1073..1077
y=1657, x=507..532
x=677, y=1428..1454
x=517, y=1193..1202
x=695, y=244..252
y=616, x=529..545
y=841, x=609..612
y=875, x=525..535
x=561, y=499..511
x=599, y=1517..1530
y=1509, x=587..605
y=1905, x=688..691
x=633, y=1758..1765
x=610, y=370..377
y=805, x=574..577
x=670, y=402..404
x=587, y=1573..1601
x=508, y=581..590
x=653, y=246..261
x=638, y=868..889
x=602, y=716..726
y=190, x=575..592
x=662, y=152..158
x=552, y=152..154
y=339, x=622..624
x=624, y=966..977
y=264, x=520..546
y=570, x=510..531
x=521, y=158..162
y=1716, x=683..687
y=1777, x=495..505
x=501, y=281..306
y=1759, x=655..672
y=726, x=586..602
x=583, y=665..667
y=1684, x=584..586
x=515, y=1590..1616
y=687, x=553..576
x=537, y=1299..1301
x=611, y=1634..1661
x=655, y=464..466
y=81, x=641..646
x=647, y=513..539
x=539, y=1086..1114
x=557, y=1418..1423
x=655, y=1188..1192
x=584, y=1681..1684
x=667, y=1688..1692
y=1654, x=644..660
y=587, x=515..518
x=609, y=1211..1213
y=21, x=492..513
x=579, y=92..108
x=678, y=650..661
x=670, y=1559..1569
x=633, y=1059..1081
x=532, y=1631..1657
y=1601, x=587..601
x=622, y=319..339
y=47, x=631..640
x=493, y=1816..1827
x=683, y=809..812
y=154, x=549..552
x=535, y=871..875
x=532, y=707..728
y=1652, x=513..515
x=556, y=1549..1573
y=1307, x=610..620
x=528, y=401..423
x=664, y=1745..1755
x=555, y=432..445
y=1193, x=514..517
x=497, y=1485..1504
x=665, y=1213..1231
y=1520, x=684..693
x=594, y=778..794
y=441, x=596..608
x=587, y=1123..1148
x=595, y=1123..1148
x=553, y=643..644
y=1961, x=635..697
x=561, y=214..223
x=616, y=1644..1668
x=529, y=1595..1603
y=1172, x=631..633
x=565, y=1125..1131
x=593, y=977..986
y=915, x=500..502
x=526, y=177..201
x=511, y=989..1017
x=576, y=195..201
x=674, y=1789..1801
y=952, x=581..599
y=930, x=573..591
x=493, y=826..835
x=521, y=107..119
x=691, y=1899..1905
y=1231, x=665..678
y=1041, x=505..526
y=1383, x=662..665
x=665, y=663..685
y=661, x=678..681
x=544, y=717..724
x=577, y=306..315
x=653, y=867..889
y=825, x=578..601
x=509, y=1299..1308
y=1667, x=652..655
x=621, y=1165..1175
y=668, x=634..638
x=633, y=612..627
x=657, y=960..967
x=681, y=649..661
y=1037, x=623..635
x=626, y=1857..1876
x=644, y=1785..1792
x=671, y=1288..1301
x=573, y=919..930
x=618, y=1442..1455
y=1796, x=682..684
x=650, y=1805..1813
x=551, y=496..506
y=1081, x=623..633
y=1755, x=664..666
x=607, y=1420..1434
x=571, y=1655..1660
x=560, y=192..203
x=664, y=394..408
x=605, y=23..42
y=1212, x=532..534
y=1197, x=613..634
x=682, y=1319..1335
x=559, y=324..337
x=654, y=1642..1650
x=655, y=1332..1345
x=668, y=834..848
x=669, y=766..768
y=1842, x=656..672
y=1050, x=620..630
x=644, y=1421..1435
y=1276, x=499..501
x=545, y=606..616
y=701, x=573..578
x=536, y=47..58
x=566, y=440..442
y=1126, x=625..629
x=533, y=624..631
x=589, y=1961..1969
x=618, y=877..889
x=596, y=1216..1223
x=584, y=1076..1085
x=505, y=1380..1384
y=40, x=647..664
x=612, y=1822..1849
y=1162, x=670..687
y=1044, x=640..663
y=1876, x=626..636
x=628, y=1938..1964
x=504, y=723..737
x=673, y=367..378
x=524, y=687..715
x=650, y=1926..1936
x=578, y=916..924
y=115, x=530..532
x=687, y=586..592
x=597, y=1497..1505
x=555, y=325..340
x=520, y=1916..1939
x=683, y=1703..1716
y=724, x=538..544
y=1424, x=589..601
y=78, x=510..526
y=1737, x=559..561
y=692, x=674..678
y=1006, x=515..530
x=499, y=621..634
y=865, x=600..602
x=530, y=920..948
x=641, y=1763..1767
x=639, y=1357..1359
x=672, y=1748..1759
y=1035, x=664..681
x=670, y=1584..1596
x=672, y=1831..1842
x=586, y=282..294
y=1862, x=678..684
y=1168, x=582..600
x=606, y=1793..1816
y=1432, x=565..583
x=530, y=1671..1688
y=1898, x=550..558
y=1846, x=541..551
x=531, y=519..532
x=555, y=237..251
x=631, y=713..730
x=561, y=1717..1737
x=601, y=999..1008
x=623, y=1059..1081
x=615, y=1971..1984
x=495, y=1752..1777
x=539, y=108..119
y=1665, x=630..632
x=595, y=342..353
x=685, y=1604..1617
y=1149, x=519..524
x=615, y=266..281
x=613, y=877..889
y=1583, x=542..547
x=663, y=198..223
x=680, y=498..505
x=690, y=1089..1094
x=553, y=1119..1135
x=637, y=1499..1507
x=562, y=863..868
x=629, y=397..402
x=495, y=337..348
x=659, y=1929..1932
x=668, y=1046..1062
y=1359, x=604..607
y=377, x=610..616
x=505, y=406..412
x=618, y=1461..1472
y=1153, x=623..648
x=674, y=1518..1530
x=687, y=1257..1276
x=525, y=1369..1377
y=1978, x=621..624
x=591, y=196..201
x=588, y=341..353
x=582, y=366..375
x=599, y=895..905
x=680, y=1126..1131
x=598, y=305..315
x=587, y=1500..1509
y=1978, x=532..539
x=533, y=1368..1377
x=660, y=385..410
y=622, x=657..663
x=578, y=1208..1210
x=656, y=1268..1281
x=551, y=1805..1814
y=1566, x=618..621
x=500, y=1113..1124
y=794, x=627..645
y=445, x=555..578
x=524, y=1136..1149
x=576, y=1554..1574
y=58, x=534..536
x=526, y=1022..1041
y=982, x=542..555
y=1427, x=681..692
x=495, y=1486..1504
y=1239, x=619..642
y=1530, x=599..674
x=542, y=1558..1583
x=612, y=832..841
x=625, y=266..281
x=498, y=1821..1824
y=1737, x=672..689
y=1551, x=582..600
x=624, y=1968..1978
y=1048, x=560..600
y=1283, x=515..538
x=595, y=1497..1505
x=674, y=1685..1695
y=1408, x=637..654
x=551, y=1825..1846
x=676, y=1539..1551
x=582, y=1540..1551
x=555, y=1087..1114
x=677, y=1374..1386
x=559, y=214..223
y=1364, x=588..615
x=595, y=1967..1974
y=1674, x=666..688
y=1099, x=638..643
x=600, y=1851..1853
y=1939, x=520..530
x=663, y=1766..1778
x=650, y=635..639
y=1765, x=613..633
x=678, y=1067..1071
x=560, y=1036..1048
y=499, x=651..657
x=496, y=1531..1534
y=1238, x=513..527
x=541, y=1129..1137
x=519, y=1032..1034
y=1745, x=602..622
x=551, y=1166..1179
x=632, y=1728..1749
x=665, y=1374..1383
x=537, y=745..767
y=97, x=632..637
x=687, y=1159..1162
x=556, y=1120..1135
x=661, y=629..643
x=527, y=1220..1238
y=768, x=669..671
x=570, y=262..272
x=678, y=1851..1862
x=582, y=1836..1848
x=583, y=894..899
x=571, y=1554..1574
x=541, y=880..884
x=620, y=1398..1412
y=183, x=545..564
x=666, y=1353..1360
x=507, y=1698..1709
x=693, y=1706..1719
y=1504, x=495..497
y=774, x=518..526
y=1088, x=570..590
x=535, y=324..340
x=563, y=1774..1797
y=525, x=505..515
x=621, y=1543..1566
x=553, y=1207..1210
x=511, y=1245..1269
y=1573, x=551..556
x=606, y=323..335
x=563, y=1812..1819
x=608, y=287..308
y=1810, x=505..518
y=571, x=658..662
y=150, x=608..635
y=706, x=564..586
y=1216, x=604..626
y=948, x=530..542
y=1129, x=625..629
y=1611, x=582..604
x=576, y=665..667
x=531, y=1278..1280
y=582, x=615..629
y=986, x=593..595
x=660, y=741..766
y=384, x=551..568
y=1133, x=617..635
x=665, y=1829..1839
x=578, y=1912..1939
y=703, x=573..578
x=594, y=735..746
x=562, y=1465..1467
x=599, y=602..612
y=967, x=635..657
y=226, x=518..538
x=586, y=695..706
x=503, y=190..204
x=578, y=701..703
x=625, y=1126..1129
x=515, y=578..587
x=595, y=977..986
x=648, y=1588..1616
x=512, y=1113..1124
x=663, y=895..917
y=884, x=576..583
y=810, x=568..584
x=492, y=1589..1616
x=501, y=1079..1083
y=203, x=555..560
x=608, y=880..892
x=653, y=1376..1389
y=917, x=636..663
x=627, y=775..794
x=646, y=825..828
y=942, x=545..552
x=629, y=580..582
x=608, y=856..870
x=682, y=1281..1297
y=1513, x=553..579
x=582, y=1822..1828
y=1545, x=667..669
x=505, y=1786..1810
x=544, y=450..462
y=356, x=664..669
x=669, y=287..295
y=1034, x=516..519
x=564, y=259..268
x=676, y=898..902
y=350, x=639..643
x=492, y=1470..1481
y=152, x=549..552
x=576, y=1868..1893
x=526, y=49..61
x=568, y=349..361
x=673, y=198..223
x=620, y=1043..1050
y=1559, x=635..652
x=564, y=15..27
y=422, x=550..565
x=585, y=1812..1819
x=627, y=1823..1849
y=61, x=526..542
x=652, y=1419..1432
y=592, x=671..687
y=823, x=673..687
x=671, y=766..768
x=492, y=85..98
x=596, y=1373..1395
x=584, y=863..868
x=676, y=1601..1614
x=639, y=246..261
y=160, x=542..562
y=612, x=534..539
x=593, y=818..822
x=532, y=1088..1105
x=542, y=980..982
x=674, y=1768..1781
x=600, y=1966..1974
x=518, y=763..774
y=1593, x=681..683
x=666, y=1311..1321
y=858, x=614..625
x=588, y=220..226
x=600, y=1037..1048
y=465, x=536..555
x=654, y=1402..1408
x=545, y=1252..1257
y=1033, x=538..542
x=642, y=1229..1239
x=639, y=1645..1668
y=1895, x=598..600
y=1820, x=672..691
x=678, y=1212..1231
x=643, y=343..350
x=675, y=402..404
x=536, y=453..465
y=318, x=636..641
y=913, x=651..653
y=692, x=614..621
y=1027, x=588..613
x=662, y=1374..1383
y=1688, x=530..547
x=588, y=640..649
x=551, y=167..179
y=1848, x=574..582
x=602, y=862..865
y=1932, x=659..661
x=695, y=80..93
y=381, x=600..622
x=664, y=1798..1803
x=519, y=966..973
x=674, y=1626..1637
x=697, y=1947..1961
x=595, y=1926..1944
x=518, y=793..805
y=844, x=685..689
y=335, x=593..606
y=945, x=609..635
x=663, y=603..622
x=565, y=1521..1532
x=518, y=1847..1875
x=564, y=694..706
x=598, y=1878..1895
y=806, x=648..675
x=524, y=321..343
x=542, y=176..201
x=672, y=1884..1888
y=1824, x=498..502
x=543, y=402..423
x=530, y=1916..1939
x=559, y=368..380
x=628, y=1727..1749
x=678, y=153..158
x=590, y=1079..1088
x=611, y=1683..1685
y=892, x=608..628
y=737, x=504..524
x=566, y=1166..1179
x=561, y=745..767
y=1332, x=510..523
x=500, y=908..915
x=516, y=1032..1034
x=683, y=1586..1593
x=535, y=834..840
y=406, x=535..537
y=226, x=580..588
x=567, y=46..68
x=640, y=1206..1215
y=609, x=534..539
x=655, y=1355..1367
y=1062, x=668..692
x=605, y=1481..1492
x=621, y=998..1008
x=597, y=895..905
x=645, y=775..794
x=497, y=1377..1388
y=1403, x=515..525
x=555, y=980..982
y=822, x=591..593
x=663, y=755..772
y=1797, x=563..572
x=531, y=560..570
x=515, y=1635..1652
x=552, y=1965..1972
y=42, x=502..526
y=1071, x=662..678
y=1778, x=663..665
x=582, y=1163..1168
x=645, y=1663..1675
x=502, y=1821..1824
y=411, x=598..619
x=653, y=905..913
x=679, y=1806..1817
x=534, y=1854..1856
x=584, y=737..750
x=652, y=1660..1667
y=1685, x=608..611
y=634, x=499..582
x=601, y=1377..1390
y=889, x=506..519
x=569, y=1217..1223
x=673, y=820..823
y=814, x=605..633
x=644, y=99..120
y=316, x=562..568
x=530, y=320..343
x=602, y=1725..1745
x=568, y=217..229
x=582, y=1126..1131
x=649, y=937..942
y=1090, x=660..677
x=583, y=876..884
x=658, y=549..571
y=750, x=584..600
x=671, y=586..592
x=529, y=606..616
x=568, y=798..810
x=492, y=8..21
x=574, y=602..616
y=768, x=569..590
x=540, y=524..527
x=608, y=1683..1685
x=670, y=1158..1162
x=508, y=1427..1447
y=442, x=566..571
x=694, y=114..140
y=1972, x=512..528
y=42, x=605..625
x=582, y=579..592
y=1660, x=566..571
x=658, y=1769..1781
x=613, y=1758..1765
x=647, y=870..879
x=565, y=834..852
x=558, y=1766..1768
x=545, y=169..183
x=541, y=1825..1846
y=361, x=568..585
x=640, y=1041..1044
x=613, y=1927..1944
x=685, y=1318..1335
x=642, y=463..466
x=581, y=483..491
x=641, y=950..953
y=973, x=519..526
x=600, y=862..865
y=746, x=590..594
x=502, y=1532..1534
x=684, y=1496..1520
x=601, y=835..845
y=1939, x=578..585
x=577, y=796..805
y=308, x=608..631
y=1432, x=649..652
x=526, y=68..78
x=578, y=1373..1395
y=1692, x=665..667
y=1816, x=593..606
y=468, x=528..533
x=615, y=581..582
y=530, x=598..602
x=582, y=643..652
x=669, y=899..902
y=1734, x=679..682
y=1235, x=541..561
x=664, y=21..40
x=515, y=1003..1006
y=179, x=551..555
y=730, x=631..643
x=645, y=188..210
x=518, y=728..733
y=1923, x=598..605
y=794, x=594..607
x=534, y=47..58
y=1841, x=634..648
y=1481, x=492..500
x=532, y=1963..1978
y=1637, x=660..674
x=596, y=385..387
x=607, y=1359..1361
y=1661, x=606..611
x=520, y=240..264
x=512, y=1495..1505
x=651, y=905..913
x=602, y=503..530
y=1469, x=600..608
x=664, y=826..828
x=615, y=1348..1364
x=505, y=522..525
x=499, y=1273..1276
x=671, y=1259..1271
x=551, y=216..229
y=1454, x=667..677
x=638, y=649..668
x=590, y=735..746
x=645, y=1291..1304
x=656, y=1832..1842
x=626, y=1420..1434
y=1105, x=524..532
y=644, x=528..553
x=493, y=989..1017
y=834, x=533..535
y=158, x=662..678
y=1455, x=618..639
y=685, x=654..665
x=643, y=1084..1099
y=848, x=668..677
x=655, y=318..322
x=635, y=1030..1037
x=556, y=1268..1281
x=608, y=144..150
y=1357, x=514..530
y=1271, x=671..679
x=685, y=1090..1094
x=528, y=446..468
y=462, x=542..544
x=661, y=809..812
x=585, y=310..312
x=555, y=1858..1862
x=649, y=1265..1277
x=620, y=1281..1307
y=670, x=568..589
y=947, x=559..568
x=507, y=1632..1657
x=541, y=1222..1235
x=513, y=728..733
y=1085, x=582..584
x=660, y=1353..1360
x=644, y=1189..1192
x=583, y=58..82
x=681, y=1016..1035
x=547, y=1671..1688
x=574, y=796..805
x=637, y=187..210
x=497, y=480..485
x=672, y=1377..1389
x=502, y=786..788
x=534, y=609..612
x=583, y=1407..1432
x=648, y=855..859
x=526, y=762..774
x=568, y=310..316
y=491, x=581..608
x=592, y=602..616
y=1094, x=685..690
x=550, y=411..422
x=570, y=1265..1279
x=626, y=1205..1216
x=522, y=918..930
y=1846, x=619..621
x=655, y=513..539
y=1827, x=493..508
x=577, y=323..337
y=1817, x=677..679
x=600, y=1465..1469
x=688, y=1663..1674
x=691, y=1809..1820
x=610, y=1282..1307
x=530, y=1002..1006
y=1269, x=494..511
x=535, y=406..416
x=686, y=626..640
x=681, y=38..58
x=589, y=1410..1424
x=639, y=527..538
x=559, y=1718..1737
x=550, y=1876..1898
x=542, y=921..948
y=1849, x=612..627
x=677, y=1648..1650
y=733, x=513..518
x=684, y=1851..1862
x=657, y=483..499
x=613, y=1016..1027
y=343, x=524..530
x=588, y=310..312
x=623, y=1290..1304
x=518, y=936..948
x=614, y=669..692
x=659, y=1877..1891
y=991, x=670..683
x=584, y=92..108
x=573, y=1851..1853
x=579, y=1273..1283
y=868, x=562..584
x=543, y=474..488
x=678, y=668..692
x=679, y=1601..1614
y=1148, x=587..595
x=631, y=32..47
x=527, y=624..631
y=204, x=503..509
x=625, y=702..728
x=564, y=1675..1694
x=499, y=232..247
x=661, y=1799..1803
x=606, y=180..206
x=534, y=1427..1447
x=593, y=856..870
y=1608, x=502..506
y=1257, x=545..566
y=1083, x=501..503
x=527, y=129..142
y=261, x=639..653
x=570, y=321..330
x=592, y=1675..1694
x=496, y=758..761
y=1505, x=505..512
x=611, y=613..627
x=537, y=86..98
x=585, y=916..924
y=210, x=637..645
y=1521, x=583..592
y=251, x=580..597
x=635, y=1234..1236
y=1534, x=496..502
x=655, y=1684..1695
x=569, y=757..768
x=603, y=108..136
x=547, y=1073..1077
x=566, y=1655..1660
y=835, x=493..506
x=608, y=484..491
x=628, y=236..238
y=402, x=670..675
x=523, y=670..677
x=557, y=1742..1754
y=1281, x=547..556
y=592, x=582..601
x=601, y=1411..1424
y=1911, x=651..653
y=140, x=667..694
x=554, y=969..975
y=1719, x=674..693
x=642, y=1206..1215
x=622, y=1725..1745
y=948, x=493..518
x=552, y=938..942
y=505, x=660..680
x=630, y=836..861
x=621, y=1843..1846
y=315, x=577..598
x=614, y=1057..1070
x=598, y=1908..1923
x=639, y=343..350
x=579, y=846..849
x=582, y=1076..1085
x=620, y=702..728
x=522, y=384..390
x=529, y=301..312
x=619, y=1228..1239
y=767, x=537..561
y=377, x=494..517
x=630, y=1656..1665
y=340, x=535..555
x=623, y=1804..1813
x=554, y=694..704
x=681, y=1586..1593
x=510, y=561..570
y=1596, x=670..692
x=655, y=635..639
x=553, y=677..687
x=503, y=1079..1083
y=1484, x=613..620
x=690, y=1853..1866
x=535, y=1509..1525
x=547, y=1558..1583
y=1321, x=647..666
x=509, y=189..204
x=677, y=1081..1090
x=624, y=446..460
x=646, y=1265..1277
x=684, y=1373..1386
x=634, y=1209..1220
y=251, x=555..577
x=585, y=1912..1939
y=375, x=582..587
y=1488, x=613..620
x=517, y=363..377
y=723, x=594..596
x=582, y=622..634
x=590, y=1057..1070
y=1663, x=561..577
y=1801, x=674..691
x=524, y=830..851
y=1839, x=661..665
x=634, y=650..668
x=679, y=756..772
x=621, y=1968..1978
y=1767, x=641..647
y=953, x=641..662
y=1646, x=595..600
x=636, y=426..453
x=631, y=1234..1236
y=223, x=663..673
x=691, y=1790..1801
y=1695, x=655..674
y=1709, x=507..518
x=512, y=1377..1388
x=682, y=243..252
x=653, y=1900..1911
y=1207, x=501..527
x=675, y=168..175
x=601, y=578..592
x=662, y=1662..1675
x=595, y=59..82
x=513, y=1635..1652
y=1616, x=648..651
y=905, x=651..653
x=636, y=895..917
y=1304, x=623..645
y=1279, x=563..570
x=625, y=527..538
y=761, x=496..511
y=176, x=612..629
x=693, y=1280..1297
y=640, x=675..686
y=1367, x=655..674
x=556, y=779..790
y=1318, x=653..658
x=532, y=1210..1212
x=563, y=1266..1279
y=697, x=594..605
x=534, y=1211..1212
y=1617, x=668..685
x=502, y=909..915
x=659, y=1538..1551
x=672, y=1559..1569
x=613, y=1484..1488
x=593, y=1460..1472
x=627, y=1100..1111
x=600, y=738..750
x=648, y=1832..1841
y=1395, x=578..596
x=669, y=1926..1936
x=680, y=556..564
x=684, y=72..85
y=802, x=524..532
y=870, x=593..608
y=380, x=559..561
x=570, y=474..488
x=618, y=1543..1566
y=1111, x=583..627
x=567, y=1639..1644
x=545, y=1346..1359
x=542, y=149..160
x=629, y=1370..1373
x=506, y=1605..1608
x=669, y=329..356
y=85, x=667..684
y=247, x=588..590
x=640, y=33..47
x=639, y=1441..1455
x=690, y=37..58
x=672, y=1854..1866
y=460, x=615..624
x=494, y=363..377
x=672, y=1808..1820
x=649, y=1289..1301
x=593, y=1546..1548
x=558, y=1875..1898
y=485, x=497..505
x=542, y=450..462
y=1936, x=650..669
x=538, y=1739..1741
y=1781, x=658..674
y=1175, x=621..640
x=608, y=424..441
x=652, y=1698..1706
x=494, y=1848..1875
y=649, x=588..591
x=677, y=613..615
y=1944, x=595..613
y=281, x=615..625
x=564, y=680..684
x=509, y=406..412
x=655, y=1660..1667
y=616, x=574..592
x=654, y=664..685
y=240, x=588..590
x=500, y=492..517
x=591, y=1546..1548
x=559, y=923..947
y=337, x=559..577
y=1614, x=676..679
y=1637, x=623..628
y=120, x=644..652
x=526, y=580..590
y=1472, x=593..618
x=567, y=1823..1828
y=1297, x=682..693
y=1507, x=637..640
y=1435, x=644..663
x=495, y=1409..1418
x=661, y=938..942
x=505, y=1903..1906
x=659, y=1562..1572
x=494, y=1246..1269
x=519, y=1510..1525
x=529, y=1855..1856
x=611, y=765..775
x=530, y=1023..1036
x=515, y=66..75
y=1223, x=569..596
x=670, y=972..991
y=889, x=613..618
y=1856, x=529..534
y=942, x=649..661
x=533, y=446..468
x=638, y=1579..1605
y=1220, x=634..650
x=651, y=1900..1911
x=688, y=1900..1905
x=538, y=281..294
x=538, y=1027..1033
y=58, x=681..690
y=82, x=583..595
x=594, y=714..723
x=647, y=21..40
y=990, x=582..601
x=512, y=1298..1301
y=51, x=551..557
y=677, x=523..527
x=566, y=1859..1862
x=660, y=1081..1090
x=682, y=1669..1671
x=562, y=150..160
x=634, y=1833..1841
x=510, y=337..348
x=539, y=609..612
y=1388, x=497..512
x=518, y=66..75
x=562, y=309..316
x=624, y=479..498
x=493, y=1644..1655
x=582, y=780..790
x=625, y=23..42
x=630, y=236..238
y=667, x=576..583
x=618, y=834..845
x=522, y=540..552
x=631, y=101..116
y=511, x=541..561
y=861, x=630..635
y=528, x=609..619
x=624, y=319..339
x=652, y=1022..1038
x=666, y=1663..1674
x=673, y=555..564
y=201, x=526..542
y=1749, x=628..632
x=503, y=1380..1384
x=493, y=1300..1308
x=597, y=232..251
x=533, y=834..840
x=558, y=393..403
x=561, y=368..380
y=1236, x=631..635
x=532, y=800..802
y=506, x=551..554
x=561, y=259..268
y=1492, x=605..627
y=1377, x=525..533
x=505, y=1752..1777
y=805, x=518..541
y=146, x=643..652
y=1745, x=637..647
x=526, y=967..973
y=108, x=579..584
x=640, y=1499..1507
x=568, y=924..947
y=1188, x=619..621
y=532, x=531..549
x=564, y=170..183
x=504, y=1929..1946
y=704, x=527..554
x=591, y=897..908
y=268, x=561..564
y=1569, x=670..672
y=378, x=673..676
x=505, y=1022..1041
y=1135, x=553..556
x=661, y=1829..1839
x=546, y=241..264
x=580, y=233..251
x=631, y=1162..1172
y=1813, x=623..650
y=223, x=559..561
x=648, y=796..806
x=548, y=195..206
y=1548, x=591..593
x=643, y=125..146
y=539, x=647..655
y=840, x=533..535
x=527, y=1175..1179
x=507, y=902..911
x=576, y=678..687
x=661, y=1929..1932
y=1551, x=659..676
y=849, x=579..583
x=612, y=175..176
x=523, y=1326..1332
x=647, y=1764..1767
x=570, y=963..974
y=1768, x=558..572
x=679, y=1724..1734
x=515, y=1273..1283
x=544, y=1964..1972
x=516, y=787..788
x=692, y=1583..1596
y=206, x=606..624
x=664, y=328..356
y=527, x=540..542
x=645, y=870..879
x=600, y=1540..1551
x=580, y=219..226
x=531, y=300..312
y=643, x=639..661
x=615, y=447..460
x=577, y=1638..1644
x=667, y=114..140
x=605, y=1909..1923
y=1280, x=529..531
x=511, y=1740..1741
x=532, y=105..115
x=579, y=1495..1513
x=547, y=1268..1281
y=408, x=664..692
y=790, x=556..582
x=663, y=1422..1435
x=598, y=642..652
x=514, y=1348..1357
y=1137, x=541..543
y=1036, x=530..555
y=312, x=585..588
x=582, y=979..990
y=402, x=626..629
x=629, y=1126..1129
x=572, y=1773..1797
x=694, y=935..957
x=646, y=1022..1038
x=631, y=286..308
x=519, y=861..889
x=513, y=1221..1238
x=524, y=491..517
y=1669, x=680..682
x=504, y=124..133
x=527, y=1190..1207
y=775, x=611..622
x=593, y=324..335
y=788, x=502..516
y=1683, x=608..611
y=98, x=492..537
x=510, y=1326..1332
x=578, y=431..445
y=488, x=543..570
x=659, y=1902..1916
y=908, x=591..608
y=1916, x=643..659
y=879, x=645..647
y=1803, x=661..664
x=577, y=385..387
x=561, y=1223..1235
y=1017, x=493..511
y=403, x=558..581
x=586, y=717..726
y=1969, x=581..589
x=542, y=1417..1423
y=766, x=651..660
x=616, y=370..377
y=404, x=514..525
x=636, y=783..788
x=680, y=169..175
y=1650, x=652..654
x=657, y=264..267
x=604, y=1607..1611
y=1423, x=542..557
x=600, y=354..381
y=670, x=523..527
y=1532, x=539..565
y=1038, x=646..652
x=582, y=1273..1283
x=641, y=425..453
x=521, y=1408..1418
x=641, y=296..318
y=423, x=652..679
x=590, y=757..768
x=640, y=385..410
y=772, x=663..679
x=635, y=1472..1481
y=1213, x=609..615
y=1412, x=620..661
x=619, y=1843..1846
x=494, y=1065..1086
x=594, y=680..697
y=1124, x=500..512
x=542, y=524..527
y=1363, x=628..646
y=206, x=548..566
y=974, x=570..592
x=674, y=1172..1184
x=569, y=1868..1893
x=501, y=1273..1276
x=566, y=680..684
x=687, y=1703..1716
y=566, x=522..524
x=550, y=1742..1754
x=645, y=1369..1373
x=512, y=901..911
x=678, y=1561..1572
x=513, y=480..481
y=348, x=495..510
x=572, y=1766..1768
x=583, y=1515..1521
x=684, y=1787..1796
x=545, y=937..942
x=549, y=152..154
x=589, y=660..670
y=1384, x=503..505
x=577, y=237..251
x=552, y=1347..1359
y=1906, x=501..505
y=1974, x=595..600
x=689, y=830..844
y=1862, x=555..566
y=453, x=636..641
x=518, y=1787..1810
x=646, y=1353..1363
x=674, y=1356..1367
y=683, x=509..534
y=728, x=620..625
x=661, y=1398..1412
x=497, y=125..133
x=611, y=108..136
x=682, y=1787..1796
x=634, y=1698..1706
x=630, y=1042..1050
y=404, x=670..675
y=552, x=522..580
x=644, y=288..295
x=567, y=321..330
x=638, y=224..241
x=679, y=416..423
y=564, x=673..680
x=679, y=1259..1271
x=637, y=1402..1408
y=1819, x=563..585
x=605, y=803..814
x=655, y=1747..1759
x=583, y=846..849
x=651, y=482..499
x=675, y=1884..1888
x=623, y=1144..1153
y=498, x=614..624
x=628, y=1629..1637
x=692, y=1046..1062
y=1655, x=493..495
y=1525, x=519..535
y=423, x=528..543
y=412, x=505..509
y=957, x=678..694
y=728, x=513..518
x=581, y=941..952
x=637, y=1357..1359
y=1359, x=545..552
x=510, y=1867..1869
y=238, x=628..630
x=664, y=319..322
x=525, y=402..404
y=1718, x=565..588
x=555, y=167..179
x=561, y=1652..1663
x=530, y=479..481
x=511, y=233..247
x=551, y=708..728
x=589, y=35..50
x=525, y=1055..1075
x=609, y=943..945
x=635, y=961..967
x=553, y=1495..1513
x=530, y=1348..1357
y=466, x=642..655
x=549, y=831..851
y=416, x=535..537
x=582, y=1606..1611
x=662, y=550..571
y=312, x=529..531
y=162, x=516..521
y=1814, x=541..551
y=1671, x=680..682
y=229, x=551..568
y=1605, x=615..638
y=1754, x=550..557
y=1893, x=569..576
x=604, y=1378..1390
y=1675, x=645..662
x=511, y=758..761
y=889, x=638..653
x=527, y=694..704
y=1866, x=672..690
y=1386, x=677..684`

type vein struct {
	x1, x2 int
	y1, y2 int
}

func main() {
	// part 1
	var veins []vein
	for _, line := range utils.Lines(input) {
		var v vein
		if line[0] == 'x' {
			utils.Sscanf(line, "x=%d, y=%d..%d", &v.x1, &v.y1, &v.y2)
			v.x2 = v.x1
		} else {
			utils.Sscanf(line, "y=%d, x=%d..%d", &v.y1, &v.x1, &v.x2)
			v.y2 = v.y1
		}
		veins = append(veins, v)
	}

	maxX := utils.Maximum(len(veins), func(i int) int {
		return veins[i].x2
	})
	maxY := utils.Maximum(len(veins), func(i int) int {
		return veins[i].y2
	})
	minY := utils.Minimum(len(veins), func(i int) int {
		return veins[i].y1
	})

	grid := make([][]byte, maxY+1)
	for i := range grid {
		grid[i] = bytes.Repeat([]byte{'.'}, maxX+10)
	}
	for _, v := range veins {
		for y := v.y1; y <= v.y2; y++ {
			for x := v.x1; x <= v.x2; x++ {
				grid[y][x] = '#'
			}
		}
	}
	grid[0][500] = '+'

	// simulate one drop, recursively splitting into new drops, returning true
	// if falling into infinity
	var simulateDrop func(x, y int) bool
	simulateDrop = func(x, y int) bool {
		// follow stream as far down as possible
		for grid[y][x] != '#' && grid[y][x] != '~' {
			grid[y][x] = '|'
			y++
			if y >= len(grid) {
				// reached infinity
				return true
			}
		}
		y--
		// examine both sides
		leftX := x
		for (grid[y][leftX] != '#') && (grid[y+1][leftX] != '.' && grid[y+1][leftX] != '|') {
			leftX--
		}
		leftIsClay := grid[y][leftX] == '#'
		rightX := x + 1
		for (grid[y][rightX] != '#') && (grid[y+1][rightX] != '.' && grid[y+1][rightX] != '|') {
			rightX++
		}
		rightIsClay := grid[y][rightX] == '#'

		// if both edges are clay, fill with water at rest; otherwise, fill with
		// flowing water
		if leftIsClay && rightIsClay {
			for x := leftX + 1; x < rightX; x++ {
				grid[y][x] = '~'
			}
		} else {
			for x := leftX + 1; x < rightX; x++ {
				grid[y][x] = '|'
			}
		}
		//  recursively simulate new drops
		doneLeft := !leftIsClay && simulateDrop(leftX, y)
		doneRight := !rightIsClay && simulateDrop(rightX, y)
		return doneLeft || doneRight
	}

	for {
		// add new drip at the spout
		done := simulateDrop(500, 1)
		if done {
			break
		}
	}

	utils.Println(utils.CountGrid(grid[minY:], '|') + utils.CountGrid(grid[minY:], '~'))

	// part 2
	utils.Println(utils.CountGrid(grid[minY:], '~'))
}
